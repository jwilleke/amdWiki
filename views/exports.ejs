<%- include('header') %>
  <h1 class="h2 mb-3">Past Exports</h1>
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body">
          <% if (exports && exports.length > 0) { %>
            <ul class="list-group list-group-flush">
              <% exports.forEach(function(exp) { %>
                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-bottom">
                  <div>
                    <span class="fw-bold text-body-secondary"><%= exp.filename %></span>
                  </div>
                  <div>
                    <a href="/download/<%= encodeURIComponent(exp.filename) %>" class="btn btn-sm btn-success me-2">
                        Download
                    </a>
                    <a href="/deleteExport/<%= encodeURIComponent(exp.filename) %>" class="btn btn-sm btn-danger me-2 btn-delete">
                        Delete
                    </a>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <div class="alert alert-info">No exports found</div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

<script>
  document.addEventListener('click', async (e) => {
    if (e.target.matches('.btn-delete')) {
      e.preventDefault();

      const url = e.target.getAttribute('href');

      if (confirm('Are you sure you want to delete this export?')) {

        const res = await fetch(url, { method: 'DELETE' });

        if (res.ok) {
          location.reload();
        } else {
          alert('Error deleting export');
        }
      }
    }
  });
</script>

<%- include('footer') %>