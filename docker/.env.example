# amdWiki Docker Environment Configuration
# Copy this file to .env and customize as needed

# Host port mapping for Docker
# This is the port on your host machine that maps to the container's internal port
# Change this if port 3000 is already in use
HOST_PORT=3000

# To use a different port, change the value:
# HOST_PORT=8080

# To let Docker auto-assign a random available port, use:
# HOST_PORT=

# Container internal port (should match amdwiki.server.port in config)
# You typically don't need to change this
CONTAINER_PORT=3000

# Node environment
# Sets the NODE_ENV for the application (production, development, test)
NODE_ENV=production

# PM2 Process Management
# Maximum memory before PM2 restarts the process.
# Large wikis (14K+ pages) spike to ~3GB during search index rebuilds.
# Default: 4G. Increase if you see unexpected restarts in PM2 logs.
# PM2_MAX_MEMORY=4G

# User ID and Group ID for container process
# This ensures files created by the container match your host user permissions
# Default: 1000:1000 (matches the 'node' user in the container)
#
# To find your current user's UID and GID:
#   Linux/macOS: Run `id -u` for UID and `id -g` for GID
#   Or run: echo "UID=$(id -u)" and echo "GID=$(id -g)"
#
# Common values:
#   - First user on Linux: 1000:1000
#   - First user on macOS: 501:20
#   - Root (not recommended): 0:0
UID=1000
GID=1000

# Example: Use your current user (Linux/macOS)
# Run these commands to set dynamically:
#   export UID=$(id -u)
#   export GID=$(id -g)
#   docker-compose up -d

# Example: Run in development mode on port 8080 as current user
# NODE_ENV=development
# HOST_PORT=8080
# UID=501
# GID=20

# ============================================
# Docker Build Configuration
# ============================================

# Docker image name and tag
# Used for: docker build -t $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_TAG
DOCKER_IMAGE_NAME=amdwiki
DOCKER_IMAGE_TAG=latest

# Alternative tags for versioning
# DOCKER_IMAGE_TAG=1.3.3
# DOCKER_IMAGE_TAG=dev

# Docker registry (optional - for push to remote registry)
# Leave empty for local builds
# Examples:
#   - Docker Hub: username/amdwiki
#   - GitHub Container Registry: ghcr.io/username/amdwiki
#   - Private registry: registry.example.com/amdwiki
DOCKER_REGISTRY=

# Full image reference (auto-constructed if DOCKER_REGISTRY is set)
# This combines DOCKER_REGISTRY/DOCKER_IMAGE_NAME:DOCKER_IMAGE_TAG
# Examples:
#   - Local: amdwiki:latest
#   - Docker Hub: username/amdwiki:latest
#   - GHCR: ghcr.io/username/amdwiki:latest
# DOCKER_IMAGE_FULL=${DOCKER_REGISTRY:+$DOCKER_REGISTRY/}$DOCKER_IMAGE_NAME:$DOCKER_IMAGE_TAG

# Node.js version for build (matches Dockerfile FROM)
# Change this to use a different Node version
# Must match available node:XX-alpine images
DOCKER_NODE_VERSION=20

# Build platform (optional - for multi-architecture builds)
# Common values:
#   - linux/amd64 (Intel/AMD 64-bit)
#   - linux/arm64 (Apple Silicon, Raspberry Pi 4+)
#   - linux/arm/v7 (Raspberry Pi 3)
# Leave empty for host architecture
DOCKER_BUILD_PLATFORM=

# Build arguments (optional - passed to docker build --build-arg)
# Example: Build with different base image
# DOCKER_BUILD_ARGS=--build-arg NODE_VERSION=18

# Cache control (optional)
# Set to --no-cache to force fresh build
# Leave empty for default caching
DOCKER_NO_CACHE=

# ============================================
# Docker Compose Build Configuration
# ============================================

# Compose project name (affects container names)
# Default: directory name
# Customize to run multiple instances
COMPOSE_PROJECT_NAME=amdwiki

# Build context path (relative to docker-compose.yml location)
# Default: .. (project root)
BUILD_CONTEXT=..

# Dockerfile path (relative to build context)
# Default: docker/Dockerfile
DOCKERFILE_PATH=docker/Dockerfile

# ============================================
# Headless Installation (Optional)
# ============================================

# Enable headless installation for automated deployments (Docker/K8s)
# When set to 'true':
#   - Skips the interactive installation wizard
#   - Copies required pages to data/pages/ automatically
#   - Copies example configs to data/config/ automatically
#   - Creates .install-complete marker
#   - Uses default admin credentials (admin/admin123)
#
# IMPORTANT: Change the admin password immediately after first login!
# The wiki will display a security warning until you do.
#
# HEADLESS_INSTALL=true

# ============================================
# Traefik Reverse Proxy (Optional)
# ============================================

# Domain name for Traefik routing
# Used with docker-compose.traefik.yml for automatic HTTPS
# Example: wiki.example.com
# AMDWIKI_DOMAIN=wiki.example.com

# Note: When using Traefik, HOST_PORT is not needed
# Traefik handles all port mapping and TLS termination

# ============================================
# Runtime Configuration (ConfigurationManager)
# ============================================

# These environment variables override config file settings
# They are read by ConfigurationManager.getProperty() at runtime

# Instance Data Folder
# All instance-specific data (pages, users, attachments, logs, search index, etc.)
# can be stored in a configurable location. This allows separating code from data
# for easier deployments, backups, and multi-instance setups.
# In Docker, this is typically mounted as a volume at /app/data
# Default: ./data (relative to /app in container)
INSTANCE_DATA_FOLDER=./data

# Instance Config File
# Name of the config file to load from INSTANCE_DATA_FOLDER/config/
# This allows using different config files for different deployments
# Default: app-custom-config.json
# INSTANCE_CONFIG_FILE=app-custom-config.json

# Server configuration
AMDWIKI_HOST=0.0.0.0
AMDWIKI_PORT=3000

# Application identity
AMDWIKI_APP_NAME=amdWiki
AMDWIKI_BASE_URL=

# Security (CRITICAL - change in production!)
AMDWIKI_SESSION_SECRET=change-me-in-production

# Session configuration
AMDWIKI_SESSION_SECURE=false
AMDWIKI_SESSION_MAX_AGE=86400000

# Logging
AMDWIKI_LOG_LEVEL=info
AMDWIKI_LOG_DIR=./data/logs

# Search
AMDWIKI_SEARCH_ENABLED=true

# Maintenance mode
AMDWIKI_MAINTENANCE_MODE=false

# ============================================
# Environment Variable Usage Notes
# ============================================

# ACTIVELY USED by ConfigurationManager (override config files):
#   - AMDWIKI_HOST, AMDWIKI_PORT - Server binding
#   - AMDWIKI_BASE_URL - Application base URL
#   - AMDWIKI_SESSION_SECRET - Session encryption key
#   - AMDWIKI_APP_NAME - Application display name
#   - INSTANCE_DATA_FOLDER - Data directory location
#   - HEADLESS_INSTALL - Enable automated installation

# NOT YET IMPLEMENTED (reserved for future use):
#   - AMDWIKI_SESSION_SECURE, AMDWIKI_SESSION_MAX_AGE
#   - AMDWIKI_LOG_LEVEL, AMDWIKI_LOG_DIR
#   - AMDWIKI_SEARCH_ENABLED, AMDWIKI_MAINTENANCE_MODE
#
# To use these, mount a custom config file or extend ConfigurationManager
